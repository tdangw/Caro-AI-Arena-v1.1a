import{r,A as i,q as p,D as d,m as q,g as k,j as e,M as z}from"./index-iVqpNyTX.js";const V=({isOpen:I,onClose:L,game:t,playerProfile:c})=>{var C,X;const{playerMark:x,opponentMark:m,PlayerPieceComponent:E,OpponentPieceComponent:_}=r.useMemo(()=>{const s="opponentAvatar"in t?"X":t.playerMark||"X",o=s==="X"?"O":"X",l=s==="X"?t.playerXPieceId:t.playerOPieceId,F=o==="X"?t.playerXPieceId:t.playerOPieceId,M=i.find(a=>a.id===l&&a.type==="piece"),O=i.find(a=>a.id===F&&a.type==="piece"),G=M?M.item.component:s==="X"?p.component:d.component,U=O?O.item.component:o==="X"?p.component:d.component;return{playerMark:s,opponentMark:o,PlayerPieceComponent:G,OpponentPieceComponent:U}},[t]),S=r.useMemo(()=>{const n=i.find(s=>s.id===t.playerXPieceId&&s.type==="piece");return n?n.item.component:p.component},[t.playerXPieceId]),R=r.useMemo(()=>{const n=i.find(s=>s.id===t.playerOPieceId&&s.type==="piece");return n?n.item.component:d.component},[t.playerOPieceId]);if(!t)return null;const h="opponentAvatar"in t,f=q(t.boardState||{}),j=Object.values(t.boardState||{}).filter(n=>n==="X").length,u=Object.values(t.boardState||{}).filter(n=>n==="O").length,y=x==="X"?j:u,N=m==="X"?j:u,v=t.opponentName,b=k(c.cp),P=k(t.opponentCp),A=t.playerLevel,T=t.opponentLevel,w=h?`PVE ID: ${(C=t.id.split("_").pop())==null?void 0:C.substring(0,6)}`:`Room: ${(X=t.id.split("_").pop())==null?void 0:X.substring(0,6)}`,$=e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("h2",{className:"text-xl font-bold text-cyan-400",children:"Game Review"}),w&&e.jsx("p",{className:"text-xs text-slate-500 font-mono",children:w})]}),D=(n,s)=>{var o;return(o=t.winningLine)==null?void 0:o.some(l=>l.row===n&&l.col===s)};return e.jsx(z,{isOpen:I,onClose:L,size:"lg",title:$,children:e.jsxs("div",{className:"flex flex-col text-white",children:[e.jsxs("div",{className:"flex justify-between items-center w-full mb-4",children:[e.jsxs("div",{className:"text-left w-2/5",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("h3",{className:"font-bold text-white text-lg truncate",title:c.playerName,children:c.playerName}),e.jsxs("p",{className:"text-cyan-400 font-semibold text-sm",children:["Lv. ",A]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:[b.icon," ",b.name]}),e.jsx("div",{className:"w-5 h-5 flex-shrink-0",children:e.jsx(E,{className:x==="X"?"text-cyan-400":"text-pink-500"})}),y>0&&e.jsx("span",{className:"text-slate-400 text-xs font-bold",children:y})]})]}),e.jsxs("div",{className:"text-center w-1/5",children:[e.jsx("p",{className:`text-lg font-bold ${t.result==="win"?"text-green-400":t.result==="loss"?"text-red-400":"text-yellow-400"}`,children:t.result.toUpperCase()}),e.jsxs("p",{className:"text-xs text-slate-400",children:["⏱️ ",Math.floor(t.duration/60),"m ",t.duration%60,"s"]})]}),e.jsxs("div",{className:"text-right w-2/5",children:[e.jsxs("div",{className:"flex items-baseline gap-2 justify-end",children:[e.jsxs("p",{className:"text-cyan-400 font-semibold text-sm",children:["Lv. ",T]}),e.jsx("h3",{className:"font-bold text-white text-lg truncate",title:v,children:v})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-1",children:[N>0&&e.jsx("span",{className:"text-slate-400 text-xs font-bold",children:N}),e.jsx("div",{className:"w-5 h-5 flex-shrink-0",children:e.jsx(_,{className:m==="X"?"text-cyan-400":"text-pink-500"})}),e.jsxs("p",{className:"text-sm text-slate-400",children:[P.icon," ",P.name]})]})]})]}),e.jsx("div",{className:"grid border-t border-l border-slate-600 bg-slate-900 w-full relative",style:{gridTemplateColumns:`repeat(${f.length}, minmax(0, 1fr))`},children:f.map((n,s)=>n.map((o,l)=>e.jsxs("div",{className:"relative aspect-square flex items-center justify-center border-r border-b border-slate-600",children:[D(s,l)&&e.jsx("div",{className:"absolute inset-0 bg-yellow-400/30 animate-pulse",style:{boxShadow:"0 0 10px #facc15"}}),o==="X"&&e.jsx(S,{className:"w-full h-full p-1 text-cyan-400"}),o==="O"&&e.jsx(R,{className:"w-full h-full p-1 text-pink-500"})]},`${s}-${l}`)))})]})})};export{V as G};
