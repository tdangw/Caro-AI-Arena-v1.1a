import{u as S,r as d,a as I,j as e,M as L,g as R,X as V,A as M,D as X,f as K,b as D,B as U,c as Y}from"./index-iVqpNyTX.js";import{S as q}from"./GameModals-aTi5PvrA.js";import{G as J}from"./GameReviewModal-N_rHnb-G.js";const Q=({isOpen:r,onClose:m})=>{const{gameState:a}=S(),[p,l]=d.useState(10),{playSound:i}=I(),[x,c]=d.useState(null),u=a.pveMatchHistory,t=()=>{l(s=>s+10)};return e.jsxs(L,{isOpen:r,onClose:m,title:"PVE Match History",size:"xl",children:[e.jsx("div",{className:"max-h-[60vh] overflow-y-auto pr-2 scrollbar-hide",children:u.length===0?e.jsx("p",{className:"text-slate-400 text-center py-8",children:"No AI matches played yet."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-3",children:u.slice(0,p).map(s=>{const b=`${Math.floor(s.duration/60)}m ${s.duration%60}s`,g=R(s.opponentCp),f=V[s.result],N="O",y=s.playerOPieceId,o=M.find(v=>v.id===y&&v.type==="piece"),j=o?o.item.component:X.component,C=s.boardState?Object.values(s.boardState).filter(v=>v===N).length:0;return e.jsxs("div",{className:"bg-slate-800/50 p-3 rounded-lg mb-3 flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 w-2/5 min-w-0",children:[e.jsx("img",{src:s.opponentAvatar,alt:s.opponentName,className:"w-12 h-12 rounded-full object-cover bg-slate-700 flex-shrink-0"}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("p",{className:"font-semibold text-white truncate",children:s.opponentName}),e.jsxs("p",{className:"text-xs text-cyan-400",children:["Lv. ",s.opponentLevel]})]}),e.jsxs("p",{className:"text-xs text-slate-400 truncate flex items-center gap-2",children:[e.jsxs("span",{children:[g.icon," ",g.name]}),e.jsx("span",{className:"w-4 h-4 text-pink-500",children:e.jsx(j,{})}),C>0&&e.jsx("span",{className:"text-slate-400 text-xs font-bold",children:C})]})]})]}),e.jsxs("div",{className:"text-center text-sm flex-grow",children:[e.jsxs("div",{className:"flex items-baseline justify-center gap-3",children:[e.jsxs("span",{className:"font-bold text-base text-purple-400",children:["+",f," XP"]}),e.jsx("div",{className:"flex items-center gap-1 text-slate-400 text-xs",children:e.jsxs("span",{children:["⏱️ ",b]})})]}),e.jsx("div",{className:"text-slate-400 text-xs mt-1",children:e.jsx("p",{children:K(s.timestamp)})})]}),e.jsx("div",{className:"flex flex-col gap-1 flex-shrink-0 w-16 items-end",children:e.jsx("button",{onClick:()=>{i("select"),c(s)},className:"p-1.5 rounded-md text-xs bg-slate-700 hover:bg-slate-600 transition-colors w-full text-center",title:"Review Game",children:"Review"})})]},s.id)})}),u.length>p&&e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:t,className:"bg-slate-700 text-slate-300 text-sm px-4 py-2 rounded-full hover:bg-slate-600 transition-colors",children:"Load More"})})]})}),x&&e.jsx(J,{isOpen:!!x,onClose:()=>c(null),game:x,playerProfile:a})]})},Z=({onGoToShop:r,itemOffset:m=0})=>{const{gameState:a}=S(),{playSound:p}=I(),l=d.useMemo(()=>{const t=M.filter(s=>!a.ownedCosmeticIds.includes(s.id)&&s.price>0);return t.length>0?t:[M.find(s=>s.id==="boom_rocket")]},[a.ownedCosmeticIds]),[i,x]=d.useState(()=>m%l.length);d.useEffect(()=>{i>=l.length&&x(0)},[l.length,i]),d.useEffect(()=>{if(l.length<=1)return;const t=setInterval(()=>{x(s=>(s+1)%l.length)},5e3+m*250);return()=>clearInterval(t)},[l.length,m]);const c=l[i];if(!c)return null;const u=t=>{switch(t.type){case"piece":{const s=t.item.component;return e.jsx(s,{className:"w-14 h-14 text-cyan-300"})}case"effect":{const s=t.item.previewComponent;return e.jsx("div",{className:"w-14 h-14 flex items-center justify-center text-cyan-300",children:e.jsx(s,{})})}case"theme":{const s=t.item;return e.jsx("div",{className:`w-14 h-14 rounded-md flex items-center justify-center p-2 ${s.boardBg}`,children:e.jsx("div",{className:`w-10 h-10 rounded ${s.cellBg} border-2 ${s.gridColor}`})})}case"board":{const s=t.item;return e.jsx("div",{className:"w-14 h-14 rounded-md flex items-center justify-center p-1 border-2",style:{backgroundColor:s.style.backgroundColor,borderColor:s.style.borderColor,boxShadow:s.style.boxShadow},children:e.jsx("div",{className:"w-full h-full grid grid-cols-2 gap-px bg-slate-500/50 p-px",children:Array(4).fill(0).map((b,g)=>e.jsx("div",{className:"bg-slate-800/50"},g))})})}case"avatar":return e.jsx("img",{src:t.item.url,alt:t.name,className:"w-14 h-14 rounded-full object-cover bg-slate-700"});case"emoji":return e.jsx("span",{className:"text-4xl",children:t.item.emoji});case"animated_emoji":return e.jsx("img",{src:t.item.url,alt:t.name,className:"w-14 h-14"});default:return null}};return e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-xl p-3 w-full h-full flex flex-col items-center justify-center text-center",children:[e.jsx("h3",{className:"text-slate-400 text-xs font-bold uppercase tracking-wider mb-2",children:"Featured Item"}),e.jsx("div",{className:"w-20 h-20 flex items-center justify-center",children:u(c)}),e.jsx("p",{className:"text-white font-semibold mt-1 text-sm h-10 flex items-center",children:c.name}),e.jsx("button",{onClick:()=>{p("select"),r()},className:"mt-2 text-xs bg-yellow-500 text-black font-bold px-3 py-1 rounded-full hover:bg-yellow-400 transition-colors",children:"Go to Shop"})]})},ee=()=>{const{user:r}=D(),{gameState:m,setPlayerName:a,showToast:p}=S(),{playerName:l,playerLevel:i,playerXp:x,pveWins:c,pveLosses:u,pveDraws:t,activeAvatar:s,coins:b,cp:g,activeTease:f}=m,{playSound:N}=I(),[y,o]=d.useState(!1),[j,C]=d.useState(l),[v,h]=d.useState(null),[G,k]=d.useState(!1),[P,E]=d.useState(!1),B=()=>{if(r!=null&&r.isAnonymous){h("Guests can't change their name."),setTimeout(()=>h(null),2e3);return}if(b<100){h("Not enough coins! (100 needed)"),setTimeout(()=>h(null),2e3);return}o(!0)},O=()=>{const n=j.trim();if(n===l){o(!1);return}n&&n.length>=3&&n.length<=15?k(!0):(h("Name must be 3-15 characters."),setTimeout(()=>h(null),2e3),C(l),o(!1))},$=async()=>{E(!0),h(null);try{const n=await a(j.trim());n&&n.success?(N("confirm"),p("Name changed successfully!")):n&&(h(n.message),setTimeout(()=>h(null),3e3))}catch(n){console.error("Failed to change name:",n),h(n.message||"An unexpected error occurred."),setTimeout(()=>h(null),3e3)}finally{E(!1),k(!1),o(!1)}},W=s.url,F=Y(i),H=x/F*100,w=R(g),A=w.name==="Thách Đấu",z=A?100:w.cpInTier/100*100,T=c+u+t,_=T>0?(c/T*100).toFixed(2):"0.00";return e.jsxs("div",{className:"group relative bg-slate-800/50 border border-slate-700 rounded-xl p-4 w-full h-full transition-all duration-300 hover:border-cyan-400/50 hover:shadow-lg hover:shadow-cyan-500/10 overflow-hidden",children:[e.jsx("div",{className:"absolute -top-10 -right-10 w-32 h-32 bg-cyan-500/10 rounded-full blur-2xl transition-all duration-500 group-hover:scale-150"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:W,alt:"Player Avatar",className:"w-16 h-16 rounded-full flex-shrink-0 border-2 border-slate-600 group-hover:border-cyan-400 transition-colors object-cover bg-slate-700"}),f&&e.jsx("div",{className:"absolute -top-4 -right-4 text-4xl animate-tease-pop z-10",children:f.emoji.startsWith("assets/")?e.jsx("img",{src:f.emoji,alt:"tease",className:"w-10 h-10"}):e.jsx("span",{children:f.emoji})})]}),e.jsxs("div",{className:"flex-grow text-left",children:[y?e.jsx("input",{type:"text",value:j,onChange:n=>C(n.target.value),onBlur:O,onKeyPress:n=>n.key==="Enter"&&O(),className:"bg-slate-900 border border-slate-600 rounded px-2 py-1 text-white text-lg font-bold w-full",autoFocus:!0,maxLength:15}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-bold text-white truncate",children:l}),e.jsx("button",{onClick:B,className:"text-slate-400 hover:text-white transition-colors",title:"Edit name (Costs 100 coins)",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L16.732 3.732z"})})})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[e.jsxs("span",{className:"font-semibold text-cyan-400 text-sm",children:["Level ",i]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-yellow-400 font-bold text-sm",children:b}),e.jsx("span",{className:"text-yellow-400",children:"💰"})]})]})]})]}),v&&e.jsx("p",{className:"text-red-500 text-xs text-center absolute -bottom-2 left-1/2 -translate-x-1/2 w-full",children:v}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-baseline text-xs text-slate-400 mb-1 px-1",children:[e.jsx("span",{className:"font-semibold",children:"XP"}),e.jsxs("span",{children:[x," / ",F]})]}),e.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-cyan-400 to-blue-500 h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${H}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-baseline text-xs text-slate-400 mb-1 px-1",children:[e.jsxs("span",{className:"font-semibold flex items-center gap-1.5",children:[w.icon," ",w.name]}),e.jsx("span",{children:A?`${w.cpInTier} CP`:`${w.cpInTier} / 100`})]}),e.jsx("div",{className:"w-full bg-slate-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all duration-500 ease-out",style:{width:`${z}%`}})})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center mt-3",children:[e.jsxs("div",{className:"transition-transform duration-200 hover:scale-110 p-1 rounded-lg",children:[e.jsx("p",{className:"text-green-400 font-bold text-sm",children:c}),e.jsx("p",{className:"text-slate-400 text-[10px] leading-tight uppercase tracking-wider",children:"Wins"})]}),e.jsxs("div",{className:"transition-transform duration-200 hover:scale-110 p-1 rounded-lg",children:[e.jsx("p",{className:"text-red-400 font-bold text-sm",children:u}),e.jsx("p",{className:"text-slate-400 text-[10px] leading-tight uppercase tracking-wider",children:"Losses"})]}),e.jsxs("div",{className:"transition-transform duration-200 hover:scale-110 p-1 rounded-lg",children:[e.jsxs("p",{className:"text-cyan-400 font-bold text-sm",children:[_,"%"]}),e.jsx("p",{className:"text-slate-400 text-[10px] leading-tight uppercase tracking-wider",children:"Win Rate"})]})]})]}),e.jsx(L,{isOpen:G,onClose:()=>k(!1),title:"Confirm Name Change",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-slate-300 mb-6",children:["Are you sure you want to change your name to ",e.jsx("strong",{className:"text-white",children:j.trim()}),"? This will cost ",e.jsx("strong",{className:"text-yellow-400",children:"100 💰"}),"."]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:()=>{N("select"),k(!1),o(!1)},className:"bg-slate-600 hover:bg-slate-500 font-bold py-2 px-6 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:$,disabled:P,className:"bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-6 rounded-lg transition-colors disabled:bg-slate-500",children:P?"Saving...":"Confirm"})]})]})})]})},se=({bot:r,onChallenge:m,stats:a})=>{const l={easy:"border-green-500",medium:"border-purple-500",hard:"border-orange-500"}[r.skillLevel],i=a.wins+a.losses+a.draws,x=i>0?(a.wins/i*100).toFixed(2):"0.00";return e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700 rounded-xl p-4 text-center transition-all duration-300 flex flex-col backdrop-blur-sm hover:border-cyan-400",children:[e.jsxs("div",{children:[e.jsx("img",{src:r.avatar,alt:r.name,className:`w-16 h-16 rounded-full mx-auto mb-3 border-2 ${l} object-cover bg-slate-700`}),e.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:r.name})]}),e.jsxs("div",{className:"flex flex-col flex-grow",children:[e.jsx("p",{className:"text-slate-400 text-xs mb-3",children:r.description}),e.jsxs("div",{className:"mt-auto",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-1 text-center mb-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-green-400",children:a.wins}),e.jsx("p",{className:"text-slate-500 tracking-wider text-[10px]",children:"WINS"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-red-400",children:a.losses}),e.jsx("p",{className:"text-slate-500 tracking-wider text-[10px]",children:"LOSSES"})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-cyan-400",children:[x,"%"]}),e.jsx("p",{className:"text-slate-500 tracking-wider text-[10px]",children:"WIN RATE"})]})]}),e.jsx("button",{onClick:m,className:"w-full bg-cyan-500 hover:bg-cyan-400 text-black font-bold py-2 px-3 rounded-lg transition-all text-sm",children:"Challenge"})]})]})]})},ne=({onStartGame:r,onGoToShop:m,onGoToInventory:a,onGoToOnline:p})=>{const[l,i]=d.useState(!1),[x,c]=d.useState(!1),[u,t]=d.useState(!1),{playSound:s}=I(),{user:b,logOut:g}=D(),{gameState:f}=S(),N=o=>{s("select"),r(o)},y=()=>{s("select"),i(!0)};return e.jsxs("div",{className:"min-h-screen bg-slate-900 text-white p-4 sm:p-6 flex flex-col items-center justify-start overflow-y-auto relative pt-8",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%220%200%2040%2040%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22%231e293b%22%20fill-opacity%3D%220.4%22%20fill-rule%3D%22evenodd%22%3E%3Cpath%20d%3D%22M0%2040L40%200H20L0%2020M40%2040V20L20%2040%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E')] opacity-50"}),e.jsxs("div",{className:"w-full max-w-5xl text-center z-10 flex flex-col items-center",children:[e.jsxs("h1",{className:"text-5xl md:text-6xl font-black text-white mb-1",children:["Caro ",e.jsx("span",{className:"text-cyan-400",children:"AI Arena"})]}),e.jsx("p",{className:"text-slate-400 text-md mb-8",children:"Five in a row. Infinite possibilities."}),e.jsxs("div",{className:"w-full max-w-4xl grid grid-cols-1 lg:grid-cols-3 gap-4 mb-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(ee,{})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(Z,{onGoToShop:m,itemOffset:0})}),e.jsxs("div",{className:"lg:col-span-1 grid grid-cols-2 gap-4 h-full",children:[e.jsx("button",{onClick:m,className:"w-full h-full bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-500 hover:to-indigo-500 text-white font-bold p-3 rounded-lg text-base transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center",children:"Shop 🛒"}),e.jsx("button",{onClick:a,className:"w-full h-full bg-gradient-to-r from-teal-500 to-blue-500 hover:from-teal-400 hover:to-blue-400 text-white font-bold p-3 rounded-lg text-base transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center",children:"Inventory 🎒"}),e.jsx("button",{onClick:y,className:"w-full h-full bg-slate-700 hover:bg-slate-600 text-white font-bold p-3 rounded-lg text-base transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center",children:"Settings ⚙️"}),e.jsx("button",{onClick:p,className:"w-full h-full bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-400 hover:to-red-400 text-white font-bold p-3 rounded-lg text-base transition-all duration-300 shadow-lg flex items-center justify-center transform hover:scale-105",children:"Play Online 🌎"})]})]}),e.jsxs("div",{className:"w-full max-w-4xl",children:[e.jsxs("div",{className:"flex justify-between items-center w-full mb-4 px-2",children:[e.jsx("div",{className:"w-1/3 text-left",children:e.jsxs("div",{className:"author-text flex items-center gap-1.5",children:[e.jsx("span",{className:"author-name",children:"Developed by: tdangw"}),e.jsx("span",{children:"•"}),e.jsx("button",{onClick:()=>{s("select"),c(!0)},className:"version-button",children:"v1.1a"})]})}),e.jsx("h2",{className:"w-1/3 text-2xl font-bold text-center whitespace-nowrap",children:"Choose Your Opponent"}),e.jsx("div",{className:"w-1/3 text-right",children:e.jsx("button",{onClick:()=>{s("select"),t(!0)},className:"text-sm font-medium text-slate-400 hover:text-cyan-400 transition-colors",children:"PVE History"})})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:U.map(o=>{const j=f.botStats[o.id]||{wins:0,losses:0,draws:0};return e.jsx(se,{bot:o,onChallenge:()=>N(o),stats:j},o.id)})})]})]}),e.jsx(q,{isOpen:l,onClose:()=>i(!1),onLogOut:b?g:void 0}),e.jsx(Q,{isOpen:u,onClose:()=>t(!1)}),e.jsx(L,{isOpen:x,onClose:()=>c(!1),title:"Thông tin phiên bản v1.1a",size:"md",children:e.jsxs("div",{className:"text-slate-300 space-y-3",children:[e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-left",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Đấu với AI:"})," AI thông minh có nhiều cấp độ khó, phản ứng linh hoạt."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Chơi Online:"})," Thách đấu với người chơi khác để leo lên mức Rank cao."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Bảng xếp hạng:"})," hiện có 7 cấp bậc: Sắt → Đồng → Bạc → Vàng → Kim Cương → Cao thủ → Thách đấu."]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Themes:"})," 7 chủ đề: Summer, Spring, Autumn, Winter, Ice, Retro, Ruby, kèm hiệu ứng động (ánh sáng, sao băng, lá bay...)."]}),e.jsx("li",{children:"Các nền đều được tinh chỉnh độ tương phản để hiển thị bàn cờ rõ nét."})]}),e.jsx("div",{className:"pt-4 flex justify-center",children:e.jsx("button",{onClick:()=>{s("select"),c(!1)},className:"bg-cyan-500 hover:bg-cyan-400 text-black font-bold py-2 px-4 rounded-lg transition-colors",children:"Đóng"})})]})}),e.jsx("style",{children:`
            .author-text {
                font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
                font-size: 0.75rem; /* text-xs */
                line-height: 1rem;
                color: hsl(222, 14%, 45%); /* Darker slate-ish color */
                text-shadow: 1px 1px 1px hsl(222, 47%, 11%, 0.6); /* Inset shadow */
            }
            .author-name, .version-button {
                transition: all 0.3s ease;
            }
            .author-name:hover, .version-button:hover {
                color: hsl(215, 28%, 85%); /* Lighter slate */
                text-shadow: 0 0 6px hsl(215, 28%, 85%, 0.7), 0 0 10px hsl(188, 93%, 67%, 0.5); /* Glow effect */
            }
            @keyframes tease-pop-anim {
                0% { transform: scale(0.5) rotate(15deg); opacity: 0; }
                30% { transform: scale(1.2) rotate(-10deg); opacity: 1; }
                50% { transform: scale(1.1) rotate(5deg); opacity: 1; }
                100% { transform: scale(0) rotate(-15deg); opacity: 0; }
            }
            .animate-tease-pop {
                animation: tease-pop-anim 8s ease-out forwards;
            }
        `})]})};export{ne as default};
