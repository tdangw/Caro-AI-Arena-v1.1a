import{b as G,u as D,r as i,v as z,j as e,R as E,f as M,A,w as U,a as Y,M as $,x as q,g as J,y as K,z as Q,F as W}from"./index-iVqpNyTX.js";const X=new Map(A.map(s=>[s.id,s])),Z=E.memo(({cosmetic:s})=>{switch(s.type){case"piece":{const t=s.item.component;return e.jsx(t,{className:"w-full h-full text-cyan-300"})}case"avatar":return e.jsx("img",{src:s.item.url,alt:s.name,className:"w-full h-full rounded-md object-cover bg-slate-700"});case"emoji":return e.jsx("span",{className:"text-xl",children:s.item.emoji});case"animated_emoji":return e.jsx("img",{src:s.item.url,alt:s.name,className:"w-full h-full"});case"theme":{const t=s.item;return e.jsx("div",{className:`w-full h-full rounded-sm ${t.boardBg}`})}case"board":{const t=s.item;return e.jsx("div",{className:"w-full h-full rounded-sm border-2",style:{backgroundColor:t.style.backgroundColor,borderColor:t.style.borderColor}})}case"effect":{const t=s.item.previewComponent;return e.jsx("div",{className:"w-full h-full flex items-center justify-center text-cyan-300 scale-50",children:e.jsx(t,{})})}case"victory":{const t=s.item.previewComponent;return e.jsx("div",{className:"w-full h-full flex items-center justify-center text-cyan-300 scale-50",children:e.jsx(t,{})})}case"boom":{const t=s.item.previewComponent;return e.jsx("div",{className:"w-full h-full flex items-center justify-center text-cyan-300 scale-50",children:e.jsx(t,{})})}default:return e.jsx("span",{className:"text-xl",children:"🎁"})}}),ee=()=>{const{user:s}=G(),{gameState:t}=D(),[d,j]=i.useState([]),[p,m]=i.useState(!0),[o,r]=i.useState(10);return i.useEffect(()=>{m(!0),s&&!s.isAnonymous?z(s.uid).then(c=>{j(c),m(!1)}):(j(t.purchaseHistory),m(!1))},[s,t.purchaseHistory]),p?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"Loading history..."}):d.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-slate-400 text-lg",children:"No purchases made yet."}),e.jsx("p",{className:"text-slate-500",children:"Items you buy from the shop will appear here."})]}):e.jsxs("div",{className:"space-y-3",children:[d.slice(0,o).map(c=>{const g=X.get(c.cosmeticId);return e.jsxs("div",{className:"bg-slate-800/50 p-3 rounded-lg flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[g&&e.jsx("div",{className:"w-10 h-10 flex-shrink-0 flex items-center justify-center bg-slate-700 rounded-md",children:e.jsx(Z,{cosmetic:g})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:c.cosmeticName}),e.jsx("p",{className:"text-xs text-slate-400",children:M(c.timestamp)})]})]}),e.jsxs("div",{className:"font-semibold text-yellow-400 flex items-center gap-1.5",children:[e.jsx("span",{children:c.price}),e.jsx("span",{children:"💰"})]})]},c.id)}),d.length>o&&e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>r(c=>c+10),className:"bg-slate-700 text-slate-300 text-sm px-4 py-2 rounded-full hover:bg-slate-600 transition-colors",children:"Load More"})})]})},se=new Map(A.map(s=>[s.id,s])),te=E.memo(({cosmetic:s})=>{switch(s.type){case"piece":{const t=s.item.component;return e.jsx(t,{className:"w-full h-full text-cyan-300"})}case"avatar":return e.jsx("img",{src:s.item.url,alt:s.name,className:"w-full h-full rounded-md object-cover bg-slate-700"});case"emoji":return e.jsx("span",{className:"text-xl",children:s.item.emoji});case"animated_emoji":return e.jsx("img",{src:s.item.url,alt:s.name,className:"w-full h-full"});case"theme":{const t=s.item;return e.jsx("div",{className:`w-full h-full rounded-sm ${t.boardBg}`})}case"board":{const t=s.item;return e.jsx("div",{className:"w-full h-full rounded-sm border-2",style:{backgroundColor:t.style.backgroundColor,borderColor:t.style.borderColor}})}case"effect":{const t=s.item.previewComponent;return e.jsx("div",{className:"w-full h-full flex items-center justify-center text-cyan-300 scale-50",children:e.jsx(t,{})})}case"victory":{const t=s.item.previewComponent;return e.jsx("div",{className:"w-full h-full flex items-center justify-center text-cyan-300 scale-50",children:e.jsx(t,{})})}case"boom":{const t=s.item.previewComponent;return e.jsx("div",{className:"w-full h-full flex items-center justify-center text-cyan-300 scale-50",children:e.jsx(t,{})})}default:return e.jsx("span",{className:"text-xl",children:"🎁"})}}),le=()=>{const{user:s}=G(),[t,d]=i.useState([]),[j,p]=i.useState(!0),[m,o]=i.useState(10);return i.useEffect(()=>{s&&!s.isAnonymous?(p(!0),U(s.uid).then(r=>{d(r),p(!1)})):p(!1)},[s]),s!=null&&s.isAnonymous?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-slate-400 text-lg",children:"Guests cannot send gifts."}),e.jsx("p",{className:"text-slate-500",children:"Sign up for an account to gift items to friends!"})]}):j?e.jsx("div",{className:"text-center text-slate-400 py-8",children:"Loading history..."}):t.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-slate-400 text-lg",children:"No gifts sent yet."}),e.jsx("p",{className:"text-slate-500",children:"You can send gifts to friends from the shop."})]}):e.jsxs("div",{className:"space-y-3",children:[t.slice(0,m).map(r=>{const c=se.get(r.cosmeticId);return e.jsxs("div",{className:"bg-slate-800/50 p-3 rounded-lg flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[c&&e.jsx("div",{className:"w-10 h-10 flex-shrink-0 flex items-center justify-center bg-slate-700 rounded-md",children:e.jsx(te,{cosmetic:c})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:r.cosmeticName}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Sent to: ",e.jsx("span",{className:"font-medium text-slate-300",children:r.recipientName})]})]})]}),e.jsx("p",{className:"text-xs text-slate-400 text-right",children:M(r.timestamp)})]},r.id)}),t.length>m&&e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>o(r=>r+10),className:"bg-slate-700 text-slate-300 text-sm px-4 py-2 rounded-full hover:bg-slate-600 transition-colors",children:"Load More"})})]})},ne=({item:s,friends:t,friendProfiles:d,isLoadingData:j,onClose:p,onGift:m})=>{const[o,r]=i.useState(null),[c,g]=i.useState(!1),{statusMessage:u,isActionDisabled:f}=i.useMemo(()=>{var C;if(!o)return{statusMessage:null,isActionDisabled:!0};if(j)return{statusMessage:"Verifying friend's inventory...",isActionDisabled:!0};const a=d.get(o),b=(a==null?void 0:a.name)||"This friend";if(!(s.type==="emoji"||s.type==="animated_emoji")){if(a!=null&&a.ownedCosmeticIds.includes(s.id))return{statusMessage:`${b} already owns this item.`,isActionDisabled:!0};if((C=a==null?void 0:a.pendingGiftIds)!=null&&C.includes(s.id))return{statusMessage:`${b} has this gift pending claim.`,isActionDisabled:!0}}return{statusMessage:null,isActionDisabled:!1}},[o,j,d,s]),w=async()=>{const a=t.find(b=>b.uid===o);a&&(g(!0),await m(a.uid,a.name),g(!1))},P=c||f,F=j&&o?"Checking...":c?"Sending...":"Send Gift";return e.jsx($,{isOpen:!0,onClose:p,title:`Gift: ${s.name}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-300 mb-4",children:"Select a friend to send this gift to."}),e.jsx("div",{className:"max-h-60 overflow-y-auto space-y-2 mb-4 pr-2 text-left scrollbar-hide",children:t.length===0?e.jsx("div",{className:"text-center text-slate-400 p-4",children:"You have no friends to send gifts to."}):t.map(a=>{const b=d.get(a.uid),N=J(b==null?void 0:b.cp);return e.jsxs("button",{onClick:()=>r(a.uid),className:`w-full p-2 rounded-lg flex items-center gap-3 transition-colors ${o===a.uid?"bg-cyan-500/30 ring-2 ring-cyan-400":"bg-slate-700 hover:bg-slate-600"}`,children:[e.jsx("img",{src:a.avatarUrl,alt:a.name,className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"text-left flex-grow",children:[e.jsx("span",{className:"font-semibold text-white",children:a.name}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Lv. ",a.level," • ",N.icon," ",N.name]})]})]},a.uid)})}),e.jsxs("div",{className:"flex justify-center gap-4 mt-4",children:[e.jsx("button",{onClick:p,className:"bg-slate-600 hover:bg-slate-500 font-bold py-2 px-6 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:w,disabled:P,className:"bg-green-600 hover:bg-green-500 disabled:bg-slate-500 disabled:cursor-not-allowed text-white font-bold py-2 px-6 rounded-lg transition-colors w-32 flex items-center justify-center",children:e.jsx("span",{style:{fontSize:"0.9rem"},children:F})})]}),e.jsx("div",{className:`text-sm mt-3 h-5 transition-colors ${u!=null&&u.includes("already")||u!=null&&u.includes("pending")?"text-red-400":"text-slate-400"}`,children:u&&e.jsx("span",{children:u})})]})})},re=({onBack:s})=>{const{user:t}=G(),{gameState:d,purchaseCosmetic:j,spendCoins:p,showToast:m}=D(),{playSound:o}=Y(),[r,c]=i.useState("Skins"),[g,u]=i.useState(null),[f,w]=i.useState(null),[P,F]=i.useState([]),[a,b]=i.useState(new Map),[N,C]=i.useState(!1),I={Skins:"piece",Avatars:"avatar",Emojis:"emoji",Themes:"theme",Boards:"board",Effects:"effect",Victory:"victory",Booms:"boom","Purchase History":"purchase history","Gift History":"gift history"};i.useEffect(()=>{if(!t||!f)return;let n=null;return(()=>{C(!0),n=q(t.uid,async v=>{const x=v.filter(h=>h.status==="friends");F(x);try{const h=x.map(k=>W(k.uid)),S=await Promise.all(h),y=new Map;S.forEach((k,O)=>{const V=x[O].uid;k&&y.set(V,k)}),b(y)}catch(h){console.error("Failed to fetch friend profiles for gifting:",h)}finally{C(!1)}})})(),()=>{n&&n()}},[t,f]);const H=n=>{o("confirm"),j(n),u(null)},B=async(n,l)=>{var v,x;if(!t||!f)return!1;if(!p(f.price))return m("Not enough coins!","error"),!1;try{return o("confirm"),await K(t.uid,d.playerName||"A Player",n,f.id),await Q(t.uid,n,l,f),m(`Gift sent to ${l}!`,"success",f.id),w(null),!0}catch(h){return console.error("Gifting transaction failed:",h),(v=h.message)!=null&&v.includes("Recipient already owns this item")?m(`${l} already owns this item.`,"error"):(x=h.message)!=null&&x.includes("Recipient has this gift pending claim")?m(`${l} has this gift pending claim.`,"error"):m("Failed to send gift. Please try again.","error"),p(-f.price),w(null),!1}},L=n=>{o("select"),u(n)},T=n=>{!t||t.isAnonymous||(o("select"),w(n))},_=n=>{switch(n.type){case"piece":{const l=n.item.component;return e.jsx(l,{className:"w-16 h-16 text-cyan-300"})}case"avatar":return e.jsx("img",{src:n.item.url,alt:n.name,className:"w-16 h-16 rounded-full object-cover bg-slate-700"});case"emoji":return e.jsx("span",{className:"text-4xl",children:n.item.emoji});case"animated_emoji":return e.jsx("img",{src:n.item.url,alt:n.name,className:"w-16 h-16"});case"theme":{const l=n.item;return e.jsx("div",{className:`w-16 h-16 rounded-md flex items-center justify-center p-2 bg-cover bg-center ${l.boardBg}`,style:l.boardBgImage?{backgroundImage:`url(${l.boardBgImage})`}:{},children:e.jsx("div",{className:`w-10 h-10 rounded ${l.cellBg} border-2 ${l.gridColor}`})})}case"board":{const l=n.item;return e.jsx("div",{className:"w-16 h-16 rounded-md flex items-center justify-center p-1 border-2",style:{backgroundColor:l.style.backgroundColor,borderColor:l.style.borderColor,boxShadow:l.style.boxShadow},children:e.jsx("div",{className:"w-full h-full grid grid-cols-3 gap-px bg-slate-500/50 p-px",children:Array(9).fill(0).map((v,x)=>e.jsx("div",{className:"bg-slate-800/50"},x))})})}case"effect":{const l=n.item.previewComponent;return e.jsx("div",{className:"w-16 h-16 flex items-center justify-center text-cyan-300",children:e.jsx(l,{})})}case"victory":{const l=n.item.previewComponent;return e.jsx("div",{className:"w-16 h-16 flex items-center justify-center text-cyan-300",children:e.jsx(l,{})})}case"boom":{const l=n.item.previewComponent;return e.jsx("div",{className:"w-16 h-16 flex items-center justify-center text-cyan-300",children:e.jsx(l,{})})}default:return null}},R=()=>{if(r==="Purchase History")return e.jsx(ee,{});if(r==="Gift History")return e.jsx(le,{});const n=A.filter(l=>r==="Emojis"?(l.type==="emoji"||l.type==="animated_emoji")&&l.price>0:l.type===I[r]&&l.price>0);return e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6",children:n.map(l=>{const v=d.ownedCosmeticIds.includes(l.id),x=d.coins>=l.price,h=l.type==="emoji"||l.type==="animated_emoji",S=d.emojiInventory[l.id]||0,y=l.price===0;return e.jsxs("div",{className:"relative bg-slate-800/50 backdrop-blur-sm border border-slate-700 rounded-xl p-4 flex flex-col items-center text-center transition-all duration-300 hover:border-cyan-400 hover:shadow-lg hover:shadow-cyan-500/10",children:[h&&S>0&&e.jsx("div",{className:"absolute top-1 right-1 bg-blue-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center border-2 border-slate-800",children:S}),e.jsx("div",{className:"h-24 w-24 mb-3 flex items-center justify-center bg-slate-900/70 rounded-lg p-2",children:_(l)}),e.jsx("h3",{className:"text-md font-semibold text-white mb-2 h-10 flex items-center justify-center",children:l.name}),e.jsxs("div",{className:"w-full mt-auto flex items-center gap-2",children:[v&&!h?e.jsx("button",{disabled:!0,className:"flex-1 py-2 px-3 rounded-lg text-sm font-semibold bg-green-600/50 text-white cursor-not-allowed",children:y?"Default":"Owned"}):e.jsxs("button",{onClick:()=>L(l),disabled:!x||y,className:`flex-1 py-2 px-2 rounded-lg font-semibold transition-all flex items-center justify-center gap-1 text-sm ${y?"bg-slate-600 text-slate-400 cursor-not-allowed":x?"bg-cyan-500 hover:bg-cyan-400 text-black":"bg-slate-600 text-slate-400 cursor-not-allowed"}`,children:[e.jsx("span",{children:l.price}),e.jsx("span",{className:"text-yellow-800",children:"💰"})]}),e.jsx("button",{onClick:()=>T(l),disabled:!x||(t==null?void 0:t.isAnonymous)||y,className:`flex-1 py-2 px-2 rounded-lg font-semibold transition-all flex items-center justify-center gap-1 text-sm ${x&&!(t!=null&&t.isAnonymous)&&!y?"bg-pink-500 hover:bg-pink-400 text-white":"bg-slate-600 text-slate-400 cursor-not-allowed"}`,children:"🎁"})]})]},l.id)})})};return e.jsxs("div",{className:"p-4 sm:p-8 h-screen bg-slate-900 text-white relative flex flex-col",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('data:image/svg+xml,%3Csvg%20width%3D%2240%22%20height%3D%2240%22%20viewBox%3D%220%200%2040%2040%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22%231e293b%22%20fill-opacity%3D%220.4%22%20fill-rule%3D%22evenodd%22%3E%3Cpath%20d%3D%22M0%2040L40%200H20L0%2020M40%2040V20L20%2040%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E')] opacity-50"}),e.jsxs("div",{className:"max-w-6xl mx-auto relative z-10 w-full flex flex-col flex-grow overflow-hidden",children:[e.jsx("header",{className:"flex-shrink-0",children:e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{className:"flex items-baseline gap-4",children:[e.jsx("h1",{className:"text-4xl font-bold text-cyan-400",children:"Shop"}),e.jsxs("span",{className:"text-yellow-400 font-bold text-lg flex items-center gap-1.5",children:[d.coins," 💰"]})]}),e.jsx("button",{onClick:s,className:"bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-lg transition-colors",children:"Back"})]})}),e.jsx("div",{className:"flex-shrink-0 mb-8 border-b border-slate-700",children:e.jsx("nav",{className:"flex space-x-1 sm:space-x-2 md:space-x-4 overflow-x-auto pb-px scrollbar-hide",children:["Skins","Avatars","Emojis","Themes","Boards","Effects","Victory","Booms","Purchase History","Gift History"].map(n=>e.jsx("button",{onClick:()=>c(n),className:`py-2 px-3 text-base sm:text-lg font-semibold transition-colors whitespace-nowrap ${r===n?"text-cyan-400 border-b-2 border-cyan-400":"text-slate-400 hover:text-white"}`,children:n},n))})}),e.jsx("main",{className:"flex-grow overflow-y-auto pr-2 -mr-2 scrollbar-hide",children:R()})]}),g&&e.jsx($,{isOpen:!!g,onClose:()=>u(null),title:"Confirm Purchase",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-slate-300 mb-6",children:["Are you sure you want to buy ",e.jsx("strong",{className:"text-white",children:g.name})," for ",e.jsxs("strong",{className:"text-yellow-400",children:[g.price," 💰"]}),"?"]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx("button",{onClick:()=>{o("select"),u(null)},className:"bg-slate-600 hover:bg-slate-500 font-bold py-2 px-6 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>H(g),className:"bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-6 rounded-lg transition-colors",children:"Confirm"})]})]})}),f&&e.jsx(ne,{item:f,friends:P,friendProfiles:a,isLoadingData:N,onClose:()=>w(null),onGift:B})]})};export{re as default};
