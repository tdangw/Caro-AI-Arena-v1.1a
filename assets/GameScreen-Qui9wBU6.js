import{r as i,T as ae,d as O,W as V,I as Ne,m as yt,e as as,l as ls,h as jt,i as is,s as cs,k as us,n as fs,j as t,R as Me,g as ms,X as ds,c as me,C as ps,b as hs,u as xs,a as vs,o as gs,P as Ke,p as ws,q as Ee,D as Ze,A as bt,E as ys,V as js,t as bs}from"./index-iVqpNyTX.js";import{U as Es,S as Ss}from"./GameModals-aTi5PvrA.js";import{C as Ns}from"./ChatBox-CVwkBmzV.js";const Se="caroGameState_inProgress",kt=()=>Array(O).fill(null).map(()=>Array(O).fill(null)),Os=()=>{var e;try{const s=localStorage.getItem(Se);if(s){const{board:n,currentPlayer:a,totalGameTime:l}=JSON.parse(s);if(n&&Array.isArray(n)&&a&&typeof l=="number"&&n.length===O&&((e=n[0])==null?void 0:e.length)===O)return{board:n,currentPlayer:a,totalGameTime:l,isDecidingFirst:!1}}}catch(s){console.error("Failed to load game state from localStorage",s),localStorage.removeItem(Se)}return{board:kt(),currentPlayer:null,totalGameTime:Ne,isDecidingFirst:!0}},Et=()=>`pve_${Date.now()}_${Math.random().toString(36).substring(2,7)}`,Cs=(e="X",s=!1)=>{const[n]=i.useState(Os),[a,l]=i.useState(Et),[o,r]=i.useState(n.board),[f,p]=i.useState(n.currentPlayer),[c,d]=i.useState(null),[m,x]=i.useState(!1),[u,h]=i.useState([]),[g,M]=i.useState(n.isDecidingFirst),[D,B]=i.useState(n.totalGameTime),[S,b]=i.useState(ae),[X,N]=i.useState(null),C=i.useRef([]),E=i.useRef([]),A=i.useRef(null),I=i.useRef(null),$=i.useRef(null);i.useEffect(()=>{if(!m&&!g&&f)try{const j={board:o,currentPlayer:f,totalGameTime:D};localStorage.setItem(Se,JSON.stringify(j))}catch(j){console.error("Failed to save game state:",j)}else localStorage.removeItem(Se)},[o,f,D,m,g]);const P=i.useCallback(()=>{A.current&&(cancelAnimationFrame(A.current),A.current=null),I.current&&(clearInterval(I.current),I.current=null)},[]);i.useEffect(()=>{if(m||g||!f||s){P();return}$.current=Date.now(),b(ae);const j=()=>{if($.current){const k=(Date.now()-$.current)/1e3,R=ae-k;R<=0?(P(),d("timeout"),x(!0),b(0)):(b(R),A.current=requestAnimationFrame(j))}};return A.current=requestAnimationFrame(j),I.current=setInterval(()=>{B(k=>k<=1?(P(),d("draw"),x(!0),0):k-1)},1e3),()=>P()},[m,g,f,s,P]);const Z=i.useCallback((j,k)=>{const R=[{r:0,c:1},{r:1,c:0},{r:1,c:1},{r:1,c:-1}];for(let G=0;G<O;G++)for(let F=0;F<O;F++)if(j[G][F]===k)for(const se of R){const ke=[];let Te=!0;for(let ne=0;ne<V;ne++){const H=G+ne*se.r,J=F+ne*se.c;if(H<0||H>=O||J<0||J>=O||j[H][J]!==k){Te=!1;break}ke.push({row:H,col:J})}if(Te)return ke}return null},[]),ge=j=>j.every(k=>k.every(R=>R!==null)),ie=i.useCallback((j,k)=>{if(!f||o[j][k]||m||g)return;C.current.push({board:o,currentPlayer:f,totalGameTime:D}),E.current.push({row:j,col:k}),N({row:j,col:k});const R=o.map(F=>[...F]);R[j][k]=f,r(R);const G=Z(R,f);G?(d(f),x(!0),h(G)):ge(R)?(d("draw"),x(!0)):p(F=>F==="X"?"O":"X")},[o,f,m,Z,g,D]),de=i.useCallback(()=>{P(),r(kt()),d(null),x(!1),h([]),B(Ne),b(ae),p(null),M(!0),C.current=[],E.current=[],N(null),localStorage.removeItem(Se),l(Et())},[P]),Q=i.useCallback(j=>{p(j),M(!1)},[]),ce=f===e&&!m&&C.current.length>0,te=i.useCallback(()=>{if(!ce)return;const j=C.current[C.current.length-2];if(j)C.current.pop(),C.current.pop(),E.current.pop(),E.current.pop(),r(j.board),p(j.currentPlayer),B(j.totalGameTime);else if(C.current.length===1){const k=C.current.pop();E.current.pop(),k&&(r(k.board),p(k.currentPlayer),B(k.totalGameTime))}N(E.current[E.current.length-1]||null),d(null),x(!1),h([]),P()},[ce,P]);return{board:o,currentPlayer:f,winner:c,isGameOver:m,makeMove:ie,resetGameForRematch:de,beginGame:Q,winningLine:u,isDecidingFirst:g,totalGameTime:D,turnTimeLeft:S,resign:()=>{!f||m||(d(f===e?"O":"X"),x(!0))},undoMove:te,canUndo:ce,moveHistory:E.current,gameId:a,playerMark:e,lastMove:X}},ks=(e,s)=>{const[n,a]=i.useState(null),[l,o]=i.useState(()=>yt({})),[r,f]=i.useState(null),[p,c]=i.useState(!0),d=i.useRef(0),[m,x]=i.useState(null),[u,h]=i.useState(null),[g,M]=i.useState(ae),[D,B]=i.useState(Ne),[S,b]=i.useState(!1),X=i.useMemo(()=>n&&s?n.players.X===s.uid?"X":"O":"X",[n,s]);return i.useEffect(()=>{if(!e||!s){c(!1),a(null);return}c(!0);const N=as(e,E=>{if(E){if(a(E),E.emotes&&s){const{uid:A,emoji:I,timestamp:$}=E.emotes;A!==s.uid&&$>d.current&&(d.current=$,x({key:$,emoji:I}))}o(A=>{const I=yt(E.board);return JSON.stringify(A)!==JSON.stringify(I)&&f(fs(A,I)),I})}else a(null);c(!1)});let C=null;return e&&s&&(C=ls(e,s.uid,A=>{var I,$;if(b(!0),A.text.startsWith("REACT:")){const P=A.text.split(":");if(P.length===3){const[,Z]=P;h({key:((I=A.timestamp)==null?void 0:I.toMillis())||Date.now(),text:`reacted with ${Z}`})}}else h({key:(($=A.timestamp)==null?void 0:$.toMillis())||Date.now(),text:A.text})})),()=>{N(),C&&C()}},[e,s]),i.useEffect(()=>{var C;if(!n||n.status==="finished"){M(ae);const E=(n==null?void 0:n.currentPlayer)||"X";B(((C=n==null?void 0:n.playerTimes)==null?void 0:C[E])??Ne);return}const N=setInterval(()=>{if(!n||!s)return;const E=(Date.now()-n.turnStartedAt)/1e3,A=ae-E;M(A);const I=n.currentPlayer,P=n.playerTimes[I]-E;B(Math.max(0,P)),P<-2&&(n.currentPlayer===X?jt(n.id,X):is(n.id,X))},500);return()=>clearInterval(N)},[n,X,s]),{board:l,currentPlayer:(n==null?void 0:n.currentPlayer)||null,winner:(n==null?void 0:n.winner)||null,isGameOver:(n==null?void 0:n.status)==="finished",winningLine:(n==null?void 0:n.winningLine)||[],isDecidingFirst:!1,isLoading:p,onlineGameData:n,lastMove:r,opponentEmote:m,hasNewMessage:S,opponentChatMessage:u,playerMark:X,gameId:(n==null?void 0:n.id)||null,activePlayerTime:D,turnTimeLeft:g,makeMove:(N,C)=>{e&&us(e,N,C,X)},resign:()=>{e&&jt(e,X)},sendEmote:N=>{e&&s&&cs(e,s.uid,N)},resetNewMessageIndicator:()=>b(!1),beginGame:()=>{},resetGameForRematch:()=>{},undoMove:()=>{},canUndo:!1,moveHistory:[]}},st="caroOpeningBook_v1",Ts=8,Tt=e=>e.map(s=>s.map(n=>n||"-").join("")).join(""),Xt=()=>{try{const e=localStorage.getItem(st);if(e)return new Map(JSON.parse(e))}catch(e){console.error("Failed to load or parse opening book from localStorage",e),localStorage.removeItem(st)}return new Map},Xs=e=>{try{const s=Array.from(e.entries());localStorage.setItem(st,JSON.stringify(s))}catch(s){console.error("Failed to save opening book to localStorage",s)}},As=e=>{if(!e||e.length===0)return;const s=Xt(),n=Array(15).fill(null).map(()=>Array(15).fill(null));let a="X";for(let l=0;l<e.length-1&&l<Ts;l++){const o=e[l],r=e[l+1],f=Tt(n);n[o.row][o.col]===null&&(n[o.row][o.col]=a),l%2!==0&&s.set(f,r),a=a==="X"?"O":"X"}Xs(s),console.log(`Opening book updated. Current size: ${s.size}`)},Rs=(e,s)=>{const n=Tt(e),a=s.get(n);return a&&e[a.row][a.col]===null?(console.log("AI Move: Found in opening book.",a),a):null},le=(e,s)=>{const n=[{r:0,c:1},{r:1,c:0},{r:1,c:1},{r:1,c:-1}];for(let a=0;a<O;a++)for(let l=0;l<O;l++)if(e[a][l]===s)for(const o of n){let r=1;for(let f=1;f<V;f++){const p=a+f*o.r,c=l+f*o.c;if(p>=0&&p<O&&c>=0&&c<O&&e[p][c]===s)r++;else break}if(r===V)return!0}return!1},Oe=e=>{const s=new Set;let n=!1;const a=Math.floor(O/2);for(let l=0;l<O;l++)for(let o=0;o<O;o++)if(e[l][o]!==null){n=!0;for(let r=-2;r<=2;r++)for(let f=-2;f<=2;f++){if(r===0&&f===0)continue;const p=l+r,c=o+f;p>=0&&p<O&&c>=0&&c<O&&e[p][c]===null&&s.add(`${p},${c}`)}}if(!n)return[{row:a,col:a}];if(s.size===0){const l=[];for(let o=0;o<O;o++)for(let r=0;r<O;r++)e[o][r]===null&&l.push({row:o,col:r});return l}return Array.from(s).map(l=>{const[o,r]=l.split(",").map(Number);return{row:o,col:r}})},z={FIVE:1e7,LIVE_FOUR:5e5,DEAD_FOUR:4e5,LIVE_THREE:5e4,DEAD_THREE:1e4,LIVE_TWO:700,DEAD_TWO:100,LIVE_ONE:10,DEAD_ONE:1},Pe=(e,s)=>{const n=s==="X"?"O":"X",a=e.filter(m=>m===s).length,l=e.filter(m=>m===n).length;if(a>0&&l>0)return 0;const o=a||l,r=a>0?s:n,f=e[0],p=e[e.length-1];let c=0;f===null&&c++,p===null&&c++;let d=0;return o===5?d=z.FIVE:o===4?d=c===2?z.LIVE_FOUR:c===1?z.DEAD_FOUR:0:o===3?d=c===2?z.LIVE_THREE:c===1?z.DEAD_THREE:0:o===2?d=c===2?z.LIVE_TWO:c===1?z.DEAD_TWO:0:o===1&&(d=c===2?z.LIVE_ONE:c===1?z.DEAD_ONE:0),r===s?d:-d},Qe=(e,s)=>{let n=0;for(let a=0;a<O;a++)for(let l=0;l<O;l++){if(e[a][l]===s?n+=7-(Math.abs(a-7)+Math.abs(l-7))/2:e[a][l]!==null&&(n-=7-(Math.abs(a-7)+Math.abs(l-7))/2),l<=O-V){const o=[];for(let r=0;r<V;r++)o.push(e[a][l+r]);n+=Pe(o,s)}if(a<=O-V){const o=[];for(let r=0;r<V;r++)o.push(e[a+r][l]);n+=Pe(o,s)}if(a<=O-V&&l<=O-V){const o=[];for(let r=0;r<V;r++)o.push(e[a+r][l+r]);n+=Pe(o,s)}if(a>=V-1&&l<=O-V){const o=[];for(let r=0;r<V;r++)o.push(e[a-r][l+r]);n+=Pe(o,s)}}return n},nt=(e,s,n)=>{const a=s==="X"?"O":"X",l=Oe(e);let o=null,r=-1/0,f=null,p=-1/0;for(const c of l){const d=e.map(h=>[...h]);d[c.row][c.col]=a;const m=n(d,a);m>r&&(r=m,o={move:c,score:m});const x=e.map(h=>[...h]);x[c.row][c.col]=s;const u=n(x,s);u>p&&(p=u,f={move:c,score:u})}return{bestOpponentMove:o,bestAiMove:f}},Is=(e,s)=>{const{row:n,col:a}=s,l=e[n][a];if(!l)return[];const o=[],r=[{r:0,c:1},{r:1,c:0},{r:1,c:1},{r:1,c:-1}];for(const f of r)for(let p=-4;p<=0;p++){const c=[];let d=!0;for(let m=0;m<5;m++){const x=n+(p+m)*f.r,u=a+(p+m)*f.c;if(x<0||x>=O||u<0||u>=O){d=!1;break}c.push({row:x,col:u,state:e[x][u]})}if(d){const m=c.filter(u=>u.state===l).length;if(c.filter(u=>u.state!==null&&u.state!==l).length>0)continue;(m===4||m===3)&&o.push(c.filter(u=>u.state===l).map(({row:u,col:h})=>({row:u,col:h})))}}return o},rt=(e,s,n,a,l,o,r)=>{if(s===0||le(e,"X")||le(e,"O"))return{score:r(e,o)};const f=Oe(e);if(f.length===0)return{score:r(e,o)};let p=f[0];if(l){let c=-1/0;for(const d of f){const m=e.map(u=>[...u]);m[d.row][d.col]=o;const x=rt(m,s-1,n,a,!1,o,r);if(x.score>c&&(c=x.score,p=d),n=Math.max(n,x.score),a<=n)break}return{score:c,move:p}}else{let c=1/0;const d=o==="X"?"O":"X";for(const m of f){const x=e.map(h=>[...h]);x[m.row][m.col]=d;const u=rt(x,s-1,n,a,!0,o,r);if(u.score<c&&(c=u.score,p=m),a=Math.min(a,u.score),a<=n)break}return{score:c,move:p}}},St=(e,s,n,a,l)=>{var p;const o=s==="X"?"O":"X",r=Oe(e);for(const c of r){const d=e.map(m=>[...m]);if(d[c.row][c.col]=s,le(d,s))return c}for(const c of r){const d=e.map(m=>[...m]);if(d[c.row][c.col]=o,le(d,o))return c}if(l==="easy"){const{bestOpponentMove:c,bestAiMove:d}=nt(e,s,a);return c&&c.score>=z.DEAD_THREE?d&&d.score>c.score*1.2?(console.log("Easy AI: Found a better offensive move, ignoring block.",d.move),d.move):(console.log("Easy AI: Blocking opponent's 3-in-a-row threat.",c.move),c.move):d?d.move:r[0]}if(l==="medium"||l==="hard"){const{bestOpponentMove:c,bestAiMove:d}=nt(e,s,a),m=z.LIVE_THREE;if(c&&c.score>=m&&(!d||c.score>d.score))return console.log(`AI (${l}): Blocking critical player threat.`,c.move),c.move}const{move:f}=rt(e,n,-1/0,1/0,!0,s,a);return f&&((p=e[f.row])==null?void 0:p[f.col])===null?f:(console.error("Minimax failed to return a valid move, picking a random one from available moves."),r[Math.floor(Math.random()*r.length)])},ot=async(e,s,n,a,l,o,r,f,p)=>{if(s===0||le(e,"X")||le(e,"O"))return{score:r(e,o)};const c=p||Oe(e);if(c.length===0)return{score:r(e,o)};let d=c[0];if(l){let m=-1/0;for(const x of c){f.count++,f.count%25===0&&await new Promise(g=>setTimeout(g,0));const u=e.map(g=>[...g]);u[x.row][x.col]=o;const h=await ot(u,s-1,n,a,!1,o,r,f);if(h.score>m&&(m=h.score,d=x),n=Math.max(n,h.score),a<=n)break}return{score:m,move:d}}else{let m=1/0;const x=o==="X"?"O":"X";for(const u of c){f.count++,f.count%25===0&&await new Promise(M=>setTimeout(M,0));const h=e.map(M=>[...M]);h[u.row][u.col]=x;const g=await ot(h,s-1,n,a,!0,o,r,f);if(g.score<m&&(m=g.score,d=u),a=Math.min(a,g.score),a<=n)break}return{score:m,move:d}}},Ls=async(e,s,n,a)=>{var x;const l=s==="X"?"O":"X",o=Oe(e);for(const u of o){const h=e.map(g=>[...g]);if(h[u.row][u.col]=s,le(h,s))return u}for(const u of o){const h=e.map(g=>[...g]);if(h[u.row][u.col]=l,le(h,l))return u}const{bestOpponentMove:r,bestAiMove:f}=nt(e,s,a),p=z.LIVE_THREE;if(r&&r.score>=p&&(!f||r.score>f.score))return console.log("AI (hard): Blocking critical player threat via tactical analysis.",r.move),r.move;const c=[];for(const u of o){const h=e.map(S=>[...S]);h[u.row][u.col]=s;const g=a(h,s),M=e.map(S=>[...S]);M[u.row][u.col]=l;const D=a(M,s),B=g-D;c.push({move:u,score:B})}c.sort((u,h)=>h.score-u.score);const d=c.slice(0,8).map(u=>u.move),{move:m}=await ot(e,n,-1/0,1/0,!0,s,a,{count:0},d);return m&&((x=e[m.row])==null?void 0:x[m.col])===null?m:(console.error("Async Minimax failed to return a valid move, picking first available."),o[0])};let et=null;const Ps=async(e,s,n,a)=>{et===null&&(et=Xt());const l=Rs(e,et);if(l)return a&&a(l),new Promise(f=>setTimeout(()=>f(l),150));let o;switch(n){case"easy":o=1;break;case"medium":o=2;break;case"hard":o=3;break;default:o=1}if(console.log(`Local AI: Minimax (depth ${o}) for ${n} opponent. (Opening book miss)`),a){const f=St(e,s,1,Qe,n);a(f)}if(n==="hard")return Ls(e,s,o,Qe);const r=n==="easy"?400+Math.random()*300:800+Math.random()*500;return new Promise(f=>{setTimeout(()=>{const p=St(e,s,o,Qe,n);f(p)},r)})},Ms=Me.memo(({state:e,onClick:s,isWinningCell:n,pieces:a,showThinkingIndicator:l,theme:o,playPlacementEffect:r,isLastMove:f,effect:p,isGlowingPiece:c})=>{const d=a.X.component,m=a.O.component,x=`animate-effect_${p.id.split("_")[1]}`;return t.jsxs("div",{className:"w-full h-full flex items-center justify-center cursor-pointer group relative",onClick:s,children:[t.jsx("div",{className:`absolute inset-0 border-r border-b ${o.gridColor}`}),e===null&&!l&&t.jsx("div",{className:"absolute inset-0 opacity-0 group-hover:bg-white/10 transition-colors duration-200 rounded-sm"}),t.jsxs("div",{className:`w-full h-full relative transition-all duration-200 ${n?"bg-yellow-500/30 rounded-md scale-110":""}`,children:[e&&t.jsx("div",{className:"w-full h-full p-1.5",children:t.jsx("div",{className:`relative w-full h-full ${e==="X"?"text-cyan-400":"text-pink-500"}`,children:t.jsx("div",{className:r?x:"",children:t.jsx("div",{className:`${f?"last-move-highlight":""} ${c?"threat-piece-glow":""}`,children:e==="X"?t.jsx(d,{}):t.jsx(m,{})})})})}),l&&t.jsx("div",{className:"w-full h-full flex items-center justify-center",children:t.jsx("div",{className:"w-8 h-8 border-2 border-yellow-400 border-t-transparent rounded-full animate-spin"})})]})]})}),$s=({board:e,onCellClick:s,winningLine:n,pieces:a,aiThinkingCell:l,theme:o,lastMove:r,effect:f,glowingPieces:p})=>{const c=(m,x)=>n.some(u=>u.row===m&&u.col===x),d=(m,x)=>p.some(u=>u.row===m&&u.col===x);return t.jsx("div",{className:`grid ${o.cellBg} border-t border-l ${o.gridColor}`,style:{gridTemplateColumns:`repeat(${e.length}, minmax(0, 1fr))`},children:e.map((m,x)=>m.map((u,h)=>t.jsx("div",{className:"aspect-square",children:t.jsx(Ms,{state:u,onClick:()=>s(x,h),isWinningCell:c(x,h),pieces:a,showThinkingIndicator:(l==null?void 0:l.row)===x&&(l==null?void 0:l.col)===h,theme:o,playPlacementEffect:(r==null?void 0:r.row)===x&&(r==null?void 0:r.col)===h,isLastMove:(r==null?void 0:r.row)===x&&(r==null?void 0:r.col)===h,effect:f,isGlowingPiece:d(x,h)})},`${x}-${h}`)))})},Nt=Me.forwardRef(({name:e,avatar:s,level:n,player:a,align:l,isCurrent:o,piece:r,cp:f,moveCount:p},c)=>{const d=r.component,m=o?"shadow-lg shadow-yellow-500/50":"",x=a==="X"?"text-cyan-400":"text-pink-500",u=ms(f);return t.jsxs("div",{ref:c,className:`flex items-center gap-3 relative ${l==="right"?"flex-row-reverse":""}`,children:[t.jsx("img",{src:s,alt:`${e}'s avatar`,className:`w-14 h-14 rounded-full transition-all duration-300 ${m} bg-slate-700 object-cover border-2 border-slate-600`,style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.4))"}}),t.jsxs("div",{className:`${l==="right"?"text-right":""} text-shadow`,children:[t.jsxs("div",{className:`flex items-baseline gap-2 ${l==="right"?"flex-row-reverse":""}`,children:[t.jsx("h3",{className:"font-bold text-white text-lg truncate",children:e}),t.jsxs("p",{className:"text-cyan-400 font-semibold text-sm",children:["Lv. ",n]})]}),t.jsx("div",{className:`flex items-center gap-2 text-sm mt-1 ${l==="right"?"justify-end":"justify-start"}`,children:l==="left"?t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-sm text-slate-300 font-semibold",children:[u.icon," ",u.name]}),t.jsx("div",{className:`w-4 h-4 ${x}`,children:t.jsx(d,{})}),p>0&&t.jsx("span",{className:"text-slate-400 text-xs font-bold",children:p})]}):t.jsxs(t.Fragment,{children:[p>0&&t.jsx("span",{className:"text-slate-400 text-xs font-bold",children:p}),t.jsx("div",{className:`w-4 h-4 ${x}`,children:t.jsx(d,{})}),t.jsxs("p",{className:"text-sm text-slate-300 font-semibold",children:[u.icon," ",u.name]})]})})]})]})}),tt=(e,s,n=1200)=>{const[a,l]=i.useState(0),o=Me.useRef(null);return i.useEffect(()=>{if(s){let r=null;const f=p=>{r||(r=p);const c=Math.min((p-r)/n,1);l(Math.floor(c*e)),c<1&&(o.current=requestAnimationFrame(f))};o.current=requestAnimationFrame(f)}else l(0);return()=>{o.current&&cancelAnimationFrame(o.current)}},[e,n,s]),a},Bs=({show:e,winner:s,timedOutPlayer:n,playerMark:a,onReset:l,onExit:o,playerLevel:r,playerXp:f,gameMode:p,onlineGame:c,leaveCountdown:d,cpChange:m=0,pveDuration:x})=>{const[u,h]=i.useState("start"),[g,M]=i.useState(r),D=s===a,B=s==="draw",S=n===a,b=S?"loss":D?"win":B?"draw":"loss",X=e?ds[b]:0,N=e?ps[b]:0,{didLevelUp:C,initialLevel:E,initialXp:A,newLevel:I,finalXp:$}=i.useMemo(()=>{if(!e)return{didLevelUp:!1,initialLevel:r,initialXp:f,newLevel:r,finalXp:f};let j=f;for(let se=1;se<r;se++)j+=me(se);const k=j-X;let R=1,G=k,F=me(R);for(;G>=F;)G-=F,R++,F=me(R);return{didLevelUp:R<r,initialLevel:R,initialXp:G,newLevel:r,finalXp:f}},[e,r,f,X]),P=A/me(E)*100,Z=C?100:(A+X)/me(E)*100,ge=$/me(I)*100,ie=tt(N,u!=="start"),de=tt(X,u!=="start"),Q=tt(m,u!=="start"),ce=i.useMemo(()=>s==="timeout"?S?"TIME'S UP!":"OPPONENT TIMED OUT":D?"YOU WIN!":B?"IT'S A DRAW!":"YOU LOSE!",[s,S,D,B]),te=i.useMemo(()=>{if(!e)return null;let j=null;if(p==="online"&&c?j=Math.round((c.updatedAt-c.createdAt)/1e3):p==="pve"&&x!=null&&(j=x),j===null||j<0)return null;const k=Math.floor(j/60),R=j%60;return`${k}m ${R}s`},[e,p,c,x]),Ce=b==="win"?"text-green-400":b==="draw"?"text-yellow-400":"text-red-500";return i.useEffect(()=>{let j=null;if(e)return M(E),j=setTimeout(()=>{h("filling"),C?(setTimeout(()=>h("levelUp"),1200),setTimeout(()=>{M(I),h("done")},1700)):setTimeout(()=>h("done"),1200)},500),()=>{j&&clearTimeout(j)};h("start"),M(r)},[e,C,I,E,r]),t.jsxs("div",{className:`fixed inset-0 bg-black/80 flex items-center justify-center z-40 transition-opacity duration-500 ${e?"opacity-100":"opacity-0 pointer-events-none"}`,children:[t.jsxs("div",{className:`text-center transition-all duration-500 ${e?"scale-100 opacity-100":"scale-95 opacity-0"}`,children:[t.jsx("h1",{className:`text-6xl font-black ${Ce} mb-6`,children:ce}),t.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 w-80 mx-auto border border-slate-700 relative",children:[t.jsxs("div",{className:"text-left mb-4",children:[t.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[t.jsxs("span",{className:"font-semibold text-white",children:["Level ",g]}),t.jsx("span",{className:`text-sm bg-pink-500 text-white font-bold px-2 py-0.5 rounded-full transition-transform duration-300 ${u==="levelUp"?"scale-150":""}`,children:g})]}),t.jsxs("div",{className:"relative pt-4",children:[C&&(u==="levelUp"||u==="done")&&t.jsx("div",{className:"absolute top-[-1rem] left-1/2 -translate-x-1/2 pointer-events-none",children:t.jsx("span",{className:"text-sm font-bold text-yellow-200 animate-level-up-pop-and-glow",children:"LEVEL UP!"})}),t.jsx("div",{className:"bg-slate-700 h-4 rounded-full overflow-hidden",children:t.jsx("div",{className:"bg-pink-500 h-full transition-all duration-1000 ease-out",style:{width:u==="start"?`${P}%`:u==="filling"?`${Z}%`:u==="levelUp"?"100%":`${ge}%`,transitionDuration:u==="done"&&C?"0s":"1s"}})})]}),t.jsxs("p",{className:"text-right text-sm text-slate-400 mt-1",children:[u==="done"&&C?$:A+de,"/",me(g)," XP"]})]}),t.jsx("h2",{className:"text-sm font-bold text-slate-400 mb-2 uppercase tracking-wider",children:"Rewards"}),t.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-3 grid grid-cols-2 gap-y-2 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xl",children:"ðŸ’°"}),t.jsxs("span",{className:`font-bold text-yellow-400 transition-opacity duration-500 ${u!=="start"?"opacity-100":"opacity-0"}`,children:["+",ie," Coins"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xl",children:"âœ¨"}),t.jsxs("span",{className:`font-bold text-purple-400 transition-opacity duration-500 ${u!=="start"?"opacity-100":"opacity-0"}`,children:["+",de," XP"]})]}),p==="online"&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xl",children:m>=0?"ðŸ†":"ðŸ’”"}),t.jsxs("span",{className:`font-bold transition-opacity duration-500 ${u!=="start"?"opacity-100":"opacity-0"} ${m>=0?"text-green-400":"text-red-400"}`,children:[Q>=0?`+${Q}`:Q," CP"]})]}),te&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-xl",children:"â±ï¸"}),t.jsx("span",{className:`font-bold text-slate-300 transition-opacity duration-500 ${u!=="start"?"opacity-100":"opacity-0"}`,children:te})]})]})]}),t.jsxs("div",{className:"mt-8 space-y-3",children:[p==="pve"&&t.jsx("button",{onClick:l,className:"w-full max-w-sm bg-green-500 hover:bg-green-400 text-black font-bold py-3 px-6 rounded-lg transition-colors text-lg",children:"Play again!"}),t.jsxs("button",{onClick:o,className:"w-full max-w-sm bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:["Back to ",p==="online"?"Lobby":"Menu",d!==void 0&&` (${d}s)`]})]})]}),t.jsx("style",{children:`
                @keyframes level-up-pop {
                    0% { transform: scale(0.8); opacity: 0; }
                    50% { transform: scale(1.3); opacity: 1; }
                    100% { transform: scale(1); opacity: 1; }
                }
                @keyframes level-up-glow {
                    50% { text-shadow: 0 0 15px #fef08a, 0 0 8px #facc15; }
                }
                .animate-level-up-pop-and-glow {
                    animation: level-up-pop 0.5s cubic-bezier(0.25, 1, 0.5, 1) forwards, level-up-glow 1.5s ease-in-out infinite 0.5s;
                }
            `})]})},_s=({pieces:e,onAnimationEnd:s,playerMark:n,playSound:a,gameMode:l="pve",forcedWinner:o=null,playerInfo:r,opponentInfo:f})=>{const[p,c]=i.useState(null),[d]=i.useState(()=>o||(Math.random()<.5?"X":"O")),m=e.X.component,x=e.O.component;i.useEffect(()=>{a("deciding");const h=setTimeout(()=>{c(d),a(l==="pve"?d===n?"first_move_player":"first_move_ai":"check"),setTimeout(()=>s(d),1500)},1500);return()=>clearTimeout(h)},[d,s,n,a,l]);const u=()=>p?`${p===n?r==null?void 0:r.name:f==null?void 0:f.name} goes first!`:"Deciding who goes first...";return t.jsxs("div",{className:"absolute inset-0 bg-black/70 flex flex-col items-center justify-center rounded-lg z-20",children:[t.jsxs("div",{className:"relative w-48 h-24",children:[t.jsx("div",{className:`absolute top-0 w-24 h-24 p-2 transition-all duration-500 ease-out ${p?p==="X"?"left-1/2 -translate-x-1/2 scale-125":"left-0 opacity-0 -translate-x-full":"left-0 animate-slide-in-left"}`,children:t.jsx(m,{className:"text-cyan-400"})}),t.jsx("div",{className:`absolute top-0 w-24 h-24 p-2 transition-all duration-500 ease-out ${p?p==="O"?"left-1/2 -translate-x-1/2 scale-125":"right-0 opacity-0 translate-x-full":"right-0 animate-slide-in-right"}`,children:t.jsx(x,{className:"text-pink-500"})})]}),t.jsx("p",{className:"text-white font-semibold text-lg mt-4 transition-opacity duration-300",children:u()}),t.jsx("style",{children:`
        @keyframes slide-in-left { 0% { transform: translateX(-100vw); } 80% { transform: translateX(0); } 100% { transform: translateX(0); }}
        @keyframes slide-in-right { 0% { transform: translateX(100vw); } 80% { transform: translateX(0); } 100% { transform: translateX(0); }}
        .animate-slide-in-left { animation: slide-in-left 1s cubic-bezier(0.25, 1, 0.5, 1); }
        .animate-slide-in-right { animation: slide-in-right 1s cubic-bezier(0.25, 1, 0.5, 1); }
      `})]})},Ds=Me.memo(({duration:e,isPaused:s,isGameOver:n,isDecidingFirst:a,time:l})=>{if(n||a)return t.jsx("div",{className:"w-full h-1.5 bg-slate-800 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full bg-green-400 rounded-full",style:{width:"100%"}})});const o=Math.max(0,l/e*100),r=o<30?"bg-red-500":o<70?"bg-yellow-400":"bg-green-400";return t.jsx("div",{className:"w-full h-1.5 bg-slate-800 rounded-full overflow-hidden",children:t.jsx("div",{className:`h-full ${r} rounded-full transition-colors duration-500`,style:{width:`${o}%`}})})}),Ot=({emoji:e,startRef:s,onEnd:n})=>{const[a,l]=i.useState({top:0,left:0});i.useEffect(()=>{if(s.current){const r=s.current.getBoundingClientRect();l({top:r.top+r.height/2,left:r.left+r.width/2})}},[s]);const o=e.startsWith("assets/");return a.top===0?null:t.jsxs("div",{className:`fixed text-5xl z-30 pointer-events-none ${o?"animate-emote-gif-fall":"animate-emote-static-fall"}`,style:{top:a.top,left:a.left},onAnimationEnd:n,children:[o?t.jsx("img",{src:e,alt:"emote",className:"w-16 h-16"}):e,t.jsx("style",{children:`
                /* Animation for GIF emojis */
                @keyframes emote-gif-fall-anim {
                    0% {
                        transform: translate(-50%, -50%) scale(0.5);
                        opacity: 0;
                    }
                    15% { /* Appear */
                        transform: translate(-50%, -50%) scale(1.2);
                        opacity: 1;
                    }
                    40% { /* Fall */
                        transform: translate(-50%, 200px) scale(1);
                        opacity: 1;
                    }
                    90% { /* Stay visible */
                        transform: translate(-50%, 200px) scale(1);
                        opacity: 1;
                    }
                    100% { /* Fade out */
                        transform: translate(-50%, 250px) scale(0.8);
                        opacity: 0;
                    }
                }
                .animate-emote-gif-fall {
                    animation: emote-gif-fall-anim 5s ease-out forwards;
                }

                /* Animation for static emojis with a wobble */
                @keyframes emote-static-fall-anim {
                    0% {
                        transform: translate(-50%, -50%) scale(0.5);
                        opacity: 0;
                    }
                    15% {
                        transform: translate(-50%, -50%) scale(1.2);
                        opacity: 1;
                    }
                    40% {
                        transform: translate(-50%, 200px) scale(1) rotate(0deg);
                        opacity: 1;
                    }
                    /* Wobble sequence starts after landing */
                    45% { transform: translate(-50%, 200px) scale(1.05) rotate(-5deg); }
                    50% { transform: translate(-50%, 200px) scale(1.05) rotate(5deg); }
                    55% { transform: translate(-50%, 200px) scale(1.02) rotate(-3deg); }
                    60% { transform: translate(-50%, 200px) scale(1.02) rotate(3deg); }
                    65% { transform: translate(-50%, 200px) scale(1) rotate(-1deg); }
                    70% { transform: translate(-50%, 200px) scale(1) rotate(1deg); }
                    75%, 90% { /* End wobble, stay still */
                        transform: translate(-50%, 200px) scale(1) rotate(0deg);
                        opacity: 1;
                    }
                    100% {
                        transform: translate(-50%, 250px) scale(0.8);
                        opacity: 0;
                    }
                }
                .animate-emote-static-fall {
                    animation: emote-static-fall-anim 5s ease-out forwards;
                }
            `})]})},Ct=({text:e,startRef:s,onEnd:n})=>{const[a,l]=i.useState({top:0,left:0});return i.useEffect(()=>{if(s.current){const o=s.current.getBoundingClientRect();l({top:o.top+o.height/2,left:o.left+o.width/2})}},[s]),a.top===0?null:t.jsxs("div",{className:"fixed z-30 pointer-events-none animate-chat-bubble-fall",style:{top:a.top,left:a.left,transform:"translate(-50%, -50%)"},onAnimationEnd:n,children:[t.jsx("div",{className:"bg-slate-800/80 backdrop-blur-sm text-white text-sm rounded-lg p-2 shadow-lg max-w-xs border border-slate-600 w-fit break-words",children:e}),t.jsx("style",{children:`
                @keyframes chat-bubble-fall-anim {
                    0% {
                        transform: translate(-50%, -50%) scale(0.5);
                        opacity: 0;
                    }
                    20% {
                        transform: translate(-50%, -50%) scale(1.1);
                        opacity: 1;
                    }
                    80% {
                        transform: translate(-50%, 250px) scale(1);
                        opacity: 1;
                    }
                    100% {
                        transform: translate(-50%, 300px) scale(0.8);
                        opacity: 0;
                    }
                }
                .animate-chat-bubble-fall {
                    animation: chat-bubble-fall-anim 3.5s ease-out forwards;
                }
            `})]})},Fs=e=>{const s=Math.floor(e/60),n=Math.round(e%60);return`${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},Vs=({gameMode:e,bot:s,onlineGameId:n,onExit:a,theme:l,pieces:o,playerInfo:r,activeEffect:f,activeVictoryEffect:p,activeBoomEffect:c,activeBoard:d,isPaused:m,onOpenShop:x,onOpenInventory:u})=>{var vt,gt;const{user:h}=hs(),{gameState:g,consumeEmoji:M,spendCoins:D,applyGameResult:B}=xs(),{playSound:S}=vs(),b=Cs("X",m),X=ks(e==="online"?n:null,h),N=i.useMemo(()=>{if(e==="online"&&X.onlineGameData&&h){const v=X.onlineGameData.players.X===h.uid?X.onlineGameData.players.O:X.onlineGameData.players.X,y=X.onlineGameData.playerDetails[v];return{uid:v,name:(y==null?void 0:y.name)||"Opponent",avatar:(y==null?void 0:y.avatarUrl)||"assets/avatars/avatar_1.png",level:(y==null?void 0:y.level)||1,cp:y==null?void 0:y.cp}}return e==="pve"&&s?{uid:s.id,name:s.name,avatar:s.avatar,level:s.level,cp:s.cp}:{uid:"player",name:"Player",avatar:"",level:1,cp:void 0}},[e,X.onlineGameData,h,s]),C=e==="pve"?b:X,[E,A]=i.useState(o.O),[I,$]=i.useState(null),[P,Z]=i.useState(!1),[ge,ie]=i.useState(!1),[de,Q]=i.useState(!1),[ce,te]=i.useState(!1),[Ce,j]=i.useState(!1),[k,R]=i.useState(15),[G,F]=i.useState(0),[se,ke]=i.useState(null),[Te,ne]=i.useState([]),[H,J]=i.useState("none"),[Xe,pe]=i.useState(null),[At,$e]=i.useState(null),[ue,Rt]=i.useState(null),we=i.useRef(!1),[Be,at]=i.useState(null),[_e,De]=i.useState(null),[Fe,lt]=i.useState(null),[Ue,it]=i.useState(null),[It,ct]=i.useState(!1),Lt=i.useCallback(()=>{ct(!0)},[]),Ae=i.useRef(!1),ye=i.useRef(null),je=i.useRef(null),ut=i.useRef(!1),Re=i.useRef(null),Ie=i.useRef(!1),We=i.useRef(null),{board:Y,currentPlayer:fe,winner:U,isGameOver:q,winningLine:Pt,isDecidingFirst:he,gameId:ee,playerMark:L,makeMove:Mt,resign:$t,lastMove:re}=C,{onlineGameData:w,isLoading:Ge,opponentEmote:Ve,opponentChatMessage:ze,activePlayerTime:Bt,turnTimeLeft:_t,hasNewMessage:Dt,resetNewMessageIndicator:Ft}=X;w&&(ut.current=!0);const ft=i.useMemo(()=>{let v=0,y=0;for(let T=0;T<Y.length;T++)for(let _=0;_<Y[T].length;_++)Y[T][_]==="X"?v++:Y[T][_]==="O"&&y++;return{X:v,O:y}},[Y]);i.useEffect(()=>{we.current=!1,J("none"),pe(null),$e(null),ct(!1)},[ee]);const He=i.useCallback(()=>{Ie.current||(console.log("[GameScreen] handleExit called. Setting isExitingRef to true and calling onExit prop."),Ie.current=!0,a())},[a]);i.useEffect(()=>{const v=()=>{Re.current&&(clearInterval(Re.current),Re.current=null)};return H==="summary"?(R(15),Re.current=setInterval(()=>{R(y=>y<=1?(v(),setTimeout(()=>He(),0),0):y-1)},1e3)):v(),v},[H,He]),i.useEffect(()=>{var y,T;if(re&&S("move"),!re||!g.showThreats||q){ne([]);return}const v=Is(Y,re);if(v.length>0){const _=v.flat(),oe=Array.from(new Map(_.map(K=>[`${K.row},${K.col}`,K])).values());ne(oe),(((y=We.current)==null?void 0:y.row)!==re.row||((T=We.current)==null?void 0:T.col)!==re.col)&&(S("check"),We.current=re)}else ne([])},[re,Y,g.showThreats,q,S]),i.useEffect(()=>{e==="online"&&Ve&&De(Ve)},[Ve,e]),i.useEffect(()=>{ze&&it(ze)},[ze]),i.useEffect(()=>{var v;e==="online"&&n&&h&&((v=g.activePieceX)!=null&&v.id)&&gs(n,h.uid,g.activePieceX.id)},[(vt=g.activePieceX)==null?void 0:vt.id,e,n,h]);const mt=H!=="none";i.useEffect(()=>{e==="online"&&ut.current&&!Ge&&!w&&!mt&&a()},[e,Ge,w,a,mt]),i.useEffect(()=>{if(e==="pve"&&he){const v=Ke[Math.floor(Math.random()*Ke.length)];A(v)}},[e,he]),i.useEffect(()=>{const v=L==="X"?"O":"X";if(fe!==v){Ae.current=!1;return}e!=="pve"||m||he||q||!s||Ae.current||(Ae.current=!0,Math.random()<.15&&setTimeout(()=>De({key:Date.now(),emoji:ws().emoji}),500),Ps(Y,v,s.skillLevel,y=>$(y)).then(({row:y,col:T})=>{y!==-1&&!q&&!m&&Ae.current&&b.makeMove(y,T)}).finally(()=>{$(null)}))},[fe,q,Y,m,he,s,e,b,L]),i.useEffect(()=>{var v,y,T,_,oe;if(console.log(`[GAMEOVER_EFFECT] Fired. isExiting: ${Ie.current}, isGameOver: ${q}, winner: ${U}, processed: ${we.current}, onlineGameId: ${n}`),Ie.current){console.log("[GAMEOVER_EFFECT] Aborting: Exit in progress.");return}if(q&&U&&!we.current&&h){we.current=!0,J("banner"),console.log(`[GAMEOVER_EFFECT] PROCESSING a win/loss for game ${ee}`);const K=U===L?"win":U==="draw"?"draw":"loss",W=e==="pve";let be=0;if(e==="online"&&w){const xe=((v=w.playerDetails[h.uid])==null?void 0:v.cp)||0,ve=((y=w.playerDetails[N.uid])==null?void 0:y.cp)||0;be=bs(xe,ve,K),F(be)}const wt=W?s==null?void 0:s.cp:(T=w==null?void 0:w.playerDetails[N.uid])==null?void 0:T.cp;let Ye;W&&(Ye=Ne-b.totalGameTime,ke(Ye));let qe=Ee.id,Je=Ze.id;if(W)qe=L==="X"?o.X.id:E.id,Je=L==="O"?o.X.id:E.id;else if(w){const xe=w.players.X,ve=w.players.O;qe=((_=w.playerDetails[xe])==null?void 0:_.pieceId)||Ee.id,Je=((oe=w.playerDetails[ve])==null?void 0:oe.pieceId)||Ze.id}const ts={id:ee,isPVE:W,boardState:W?b.board:w==null?void 0:w.board,duration:W?Ye:void 0,winningLine:W?b.winningLine:w==null?void 0:w.winningLine,opponentCp:W?s==null?void 0:s.cp:wt,createdAt:W||w==null?void 0:w.createdAt,updatedAt:W?void 0:Date.now(),opponentDetails:W?void 0:{name:N.name,avatarUrl:N.avatar,level:N.level,cp:wt},chatId:e==="online"?w==null?void 0:w.chatId:void 0,playerLevel:r.level,playerXPieceId:qe,playerOPieceId:Je,playerMark:L};B(K,N.uid,ts,be),K==="win"?(S("win"),S("announce_win"),pe("You Win!")):K==="loss"?(S("lose"),S("announce_lose"),pe("You Lose!")):pe(U==="timeout"?"Time Out!":"Draw!"),e==="pve"&&U!==L&&K!=="draw"&&As(b.moveHistory);const ss=setTimeout(()=>{var xe,ve;if(pe(null),U!=="draw"&&U!=="timeout"){$e(U);const rs=U===L?ye:je,os=U===L?je:ye;Rt({winner:(xe=rs.current)==null?void 0:xe.getBoundingClientRect(),loser:(ve=os.current)==null?void 0:ve.getBoundingClientRect()}),setTimeout(()=>S("boom"),800),J("effects")}},2e3),ns=setTimeout(()=>{J("summary"),S("summary")},5e3);return()=>{clearTimeout(ss),clearTimeout(ns)}}},[q,U,L,B,s,ee,e,w,h,b.moveHistory,S,n,N,b.board,b.totalGameTime,b.winningLine,o.X.id,E.id,r.level]);const Le=i.useMemo(()=>{var v;if(e==="pve")return{X:o.X,O:E};if(e==="online"&&w&&h){const y=h.uid,T=w.players.X===y?w.players.O:w.players.X,_=o.X,oe=((v=w.playerDetails[T])==null?void 0:v.pieceId)||Ee.id,W=[Ee,Ze,...Ke].find(be=>be.id===oe)||Ee;return w.players.X===y?{X:_,O:W}:{X:W,O:_}}return o},[e,w,h,o,E]),dt=g.botStats[(s==null?void 0:s.id)||""]||{wins:0,losses:0},Ut=i.useMemo(()=>{const v=[],y=bt.filter(T=>T.type==="emoji"||T.type==="animated_emoji");for(const T of y){const _=g.ownedCosmeticIds.includes(T.id),oe=g.emojiInventory[T.id]||0;(_||oe>0)&&v.push(T.item)}return v},[g.ownedCosmeticIds,g.emojiInventory]),Wt=(v,y)=>{q||fe!==L||Y[v][y]!==null||Mt(v,y)},Gt=()=>{b.canUndo&&g.coins>=20&&te(!0)},Vt=()=>{D(20)&&b.undoMove(),te(!1)},zt=v=>{S("select");const y="emoji"in v?v.emoji:v.url;at({key:Date.now(),emoji:y});const T=bt.find(_=>_.id===v.id);T&&T.price>0&&M(v.id),ie(!1),e==="online"&&X.sendEmote(y)},Ht=v=>{v.startsWith("REACT:")||(lt({key:Date.now(),text:v}),Q(!1))},Yt=()=>{S("select"),Q(!0),Ft()},qt=i.useCallback(()=>{S("select"),J("none"),pe(null),$e(null),we.current=!1,e==="pve"&&b.resetGameForRematch()},[b,e,S]),Jt=()=>{typeof ee=="string"&&(navigator.clipboard.writeText(ee),j(!0),setTimeout(()=>j(!1),2e3))},pt=l.decoratorComponent,Kt=p.component,Zt=c.component,ht=e==="pve"&&he||e==="online"&&w&&Object.keys(w.board).length===0&&!q&&!It;if(e==="online"&&Ge)return t.jsx("div",{className:"min-h-screen bg-slate-900 flex items-center justify-center text-white",children:t.jsxs("div",{className:"flex flex-col items-center gap-4",children:[t.jsx("div",{className:"w-12 h-12 border-4 border-cyan-400 border-t-transparent rounded-full animate-spin"}),t.jsx("p",{className:"text-xl",children:"Entering match..."})]})});const Qt=e==="pve"?b.totalGameTime:Bt,es=e==="pve"?b.turnTimeLeft:_t,xt=e==="online"&&ee?`Room: ${(gt=ee.split("_").pop())==null?void 0:gt.substring(0,6)}`:null;return t.jsxs("div",{style:l.boardBgImage?{backgroundImage:`url(${l.boardBgImage})`}:{},className:`${l.boardBg} min-h-screen p-2 sm:p-4 flex flex-col items-center justify-center font-sans transition-colors duration-500 relative overflow-hidden bg-cover bg-center bg-no-repeat`,children:[pt&&t.jsx(pt,{}),t.jsx(ys,{}),t.jsx(js,{}),Be&&t.jsx(Ot,{emoji:Be.emoji,startRef:ye,onEnd:()=>at(null)},Be.key),_e&&t.jsx(Ot,{emoji:_e.emoji,startRef:je,onEnd:()=>De(null)},_e.key),Fe&&t.jsx(Ct,{text:Fe.text,startRef:ye,onEnd:()=>lt(null)},Fe.key),Ue&&t.jsx(Ct,{text:Ue.text,startRef:je,onEnd:()=>it(null)},Ue.key),t.jsxs("div",{className:"w-full max-w-[75vmin] mx-auto relative z-10 flex flex-col justify-center",children:[t.jsxs("header",{className:"flex flex-col justify-center items-center w-full relative mb-4",children:[t.jsx("h1",{className:"text-3xl font-black bg-clip-text text-transparent bg-gradient-to-r from-cyan-300 to-blue-400 text-shadow",children:"Caro AI Arena"}),t.jsxs("div",{className:"relative flex items-center justify-center gap-4 mt-2",children:[t.jsx("button",{onClick:()=>{S("select"),Z(!0)},className:"bg-slate-800/80 p-2 rounded-full hover:bg-slate-700 transition-colors","aria-label":"Settings",children:t.jsxs("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924-1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066 2.573c-.94-1.543.826 3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e==="pve"&&t.jsx("button",{onClick:Gt,disabled:!b.canUndo||g.coins<20,className:"relative bg-slate-800/80 p-2 rounded-full hover:bg-slate-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Undo",children:t.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 15l-3-3m0 0l3-3m-3 3h8a5 5 0 000-10H9"})})}),t.jsx("button",{onClick:()=>{S("select"),ie(v=>!v)},className:"bg-slate-800/80 p-2 rounded-full hover:bg-slate-700 transition-colors","aria-label":"Emotes",children:t.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e==="online"&&t.jsxs("button",{onClick:Yt,className:"relative bg-slate-800/80 p-2 rounded-full hover:bg-slate-600 transition-colors","aria-label":"Chat",children:[t.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),Dt&&t.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full border-2 border-slate-800 animate-pulse"})]}),ge&&t.jsxs("div",{className:"absolute top-full mt-4 bg-slate-800/90 backdrop-blur-sm p-2 rounded-lg flex flex-wrap justify-center gap-2 animate-fade-in-down z-30",style:{width:"280px"},onMouseLeave:()=>ie(!1),children:[" ",Ut.map(v=>{const y="url"in v;return t.jsx("button",{onClick:()=>zt(v),className:"text-3xl w-12 h-12 flex items-center justify-center rounded-md hover:bg-slate-700/50 hover:scale-110 transition-all",children:y?t.jsx("img",{src:v.url,alt:v.name,className:"w-10 h-10"}):v.emoji},v.id)})," "]})]})]}),t.jsxs("main",{className:"flex-grow flex flex-col justify-center relative",children:[H==="banner"&&Xe&&t.jsx("div",{className:"absolute top-28 left-1/2 -translate-x-1/2 w-max px-8 py-4 bg-slate-900/80 border border-slate-700 rounded-2xl shadow-lg z-30 pointer-events-none animate-fade-in-down-then-out",children:t.jsx("h2",{className:`text-5xl font-black ${Xe.includes("Win")?"text-green-400":Xe.includes("Lose")?"text-red-500":"text-yellow-400"}`,style:{textShadow:"0 0 15px currentColor"},children:Xe})}),t.jsxs("div",{className:"flex justify-between items-end px-2 mb-[4px] -mt-px",children:[t.jsx(Nt,{ref:ye,name:r.name,avatar:r.avatar.url,level:r.level,align:"left",player:L,isCurrent:fe===L,piece:Le[L],cp:g.cp,moveCount:ft[L]}),t.jsxs("div",{className:"text-center pb-1 text-shadow",children:[xt&&t.jsx("div",{className:"text-xs text-slate-400 font-mono mb-1 cursor-pointer",title:"Click to copy full Game ID",onClick:Jt,children:Ce?"Copied!":xt}),e==="pve"&&s&&t.jsxs("div",{className:"text-white font-mono text-xs tracking-wider whitespace-nowrap",title:`vs ${s.name}`,children:[t.jsxs("span",{className:"text-green-400",children:["Win ",dt.wins]})," - ",t.jsxs("span",{className:"text-red-400",children:["Lose ",dt.losses]})]}),t.jsx("div",{className:"text-white font-mono text-2xl tracking-wider",children:Fs(Qt)})]}),t.jsx(Nt,{ref:je,name:N.name,avatar:N.avatar,level:N.level,align:"right",player:L==="X"?"O":"X",isCurrent:fe!==L,piece:Le[L==="X"?"O":"X"],cp:N.cp,moveCount:ft[L==="X"?"O":"X"]})]}),t.jsxs("div",{className:"w-full mx-auto",children:[t.jsx(Ds,{duration:ae,isPaused:m,isGameOver:q,isDecidingFirst:he||ht,time:es},`${ee}-${fe}`),t.jsxs("div",{className:"mt-px relative backdrop-blur-lg rounded-xl p-2 border shadow-lg",style:d.style,children:[t.jsx($s,{board:Y,onCellClick:Wt,winningLine:Pt,pieces:Le,aiThinkingCell:I,theme:l,lastMove:re,effect:f,glowingPieces:Te}),ht&&t.jsx(_s,{pieces:Le,onAnimationEnd:e==="pve"?b.beginGame:Lt,playerMark:L,playSound:S,gameMode:e,forcedWinner:e==="online"?w==null?void 0:w.currentPlayer:null,playerInfo:r,opponentInfo:N})]})]})]})]}),H==="effects"&&At&&ue&&t.jsxs(t.Fragment,{children:[t.jsx(Kt,{})," ",t.jsx(Zt,{winnerCoords:ue==null?void 0:ue.winner,loserCoords:ue==null?void 0:ue.loser})]}),t.jsx(Bs,{show:H==="summary",winner:U,timedOutPlayer:U==="timeout"?fe:null,playerMark:L,onReset:qt,onExit:He,playerLevel:g.playerLevel,playerXp:g.playerXp,gameMode:e,onlineGame:w,leaveCountdown:k,cpChange:G,pveDuration:se}),t.jsx(Es,{isOpen:ce,onClose:()=>te(!1),onConfirm:Vt,playSound:S}),t.jsx(Ss,{isOpen:P,onClose:()=>Z(!1),onOpenShop:x,onOpenInventory:u,onResign:$t}),e==="online"&&w&&h&&t.jsx(Ns,{isOpen:de,onClose:()=>Q(!1),chatId:w.chatId,currentUserId:h.uid,senderName:r.name,recipientName:N.name,recipientId:N.uid,onMessageSent:Ht}),t.jsx("style",{children:".animate-confirm-glow { animation: confirm-glow 1.5s ease-in-out infinite; } @keyframes confirm-glow { 50% { box-shadow: 0 0 15px rgba(74, 222, 128, 0.7); } } .last-move-highlight { animation: last-move-glow 2s ease-in-out infinite; } @keyframes last-move-glow { 0% { filter: drop-shadow(0 0 12px rgba(255, 255, 100, 1)) drop-shadow(0 0 6px rgba(255, 255, 100, 1)) brightness(1.5); } 10% { filter: drop-shadow(0 0 10px rgba(255, 255, 100, 0.9)); } 55% { filter: drop-shadow(0 0 4px rgba(255, 255, 100, 0.6)); } 100% { filter: drop-shadow(0 0 10px rgba(255, 255, 100, 0.9)); } } .animate-fade-in-down-then-out { animation: fade-in-down-then-out 2s cubic-bezier(0.25, 1, 0.5, 1) forwards; } @keyframes fade-in-down-then-out { 0% { transform: translateY(-50px) translateX(-50%) scale(0.8); opacity: 0; } 20% { transform: translateY(0) translateX(-50%) scale(1); opacity: 1; } 80% { transform: translateY(0) translateX(-50%) scale(1); opacity: 1; } 100% { transform: translateY(20px) translateX(-50%) scale(0.9); opacity: 0; } } .threat-piece-glow { animation: threat-glow-anim 1.5s ease-in-out infinite; } @keyframes threat-glow-anim { 50% { filter: drop-shadow(0 0 12px currentColor) brightness(1.7); } }"})]})};export{Vs as default};
